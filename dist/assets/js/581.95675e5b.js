"use strict";(self["webpackChunkvue_test"]=self["webpackChunkvue_test"]||[]).push([[581],{57581:function(e,t,n){n.r(t),n.d(t,{default:function(){return u}});var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v(" 地图")]),n("el-dialog",{attrs:{visible:e.dialogVisible,width:"70%",height:"60%",top:"10vh"},on:{close:e.closeDialog,"update:visible":function(t){e.dialogVisible=t}}},[n("div",{staticClass:"amap-page-container",staticStyle:{width:"100%",height:"550px",margin:"0px"}},[n("el-amap-search-box",{staticClass:"search-box",attrs:{"search-option":e.searchOption,"on-search-result":e.onSearchResult}}),n("el-amap",{ref:"map",staticClass:"amap-demo",attrs:{vid:"amapDemo","amap-manager":e.amapManager,center:e.center,zoom:e.zoom,plugin:e.plugin,events:e.events}},e._l(e.markers,(function(e,t){return n("el-amap-marker",{key:t,attrs:{position:e.position,label:e.label,icon:e.icon}})})),1),n("div",{staticStyle:{display:"flex",position:"relative"}},[n("div",{staticClass:"adress"},[n("p",[e._v(e._s(e.address))]),n("p",[e._v(e._s(e.center))])]),n("div",{staticClass:"confirm",on:{click:function(t){return e.comfirmLngLat(e.center,e.address)}}},[e._v("确定")])])],1)])],1)},a=[],i=(n(57658),n(42325)),r=n(25275);let s=new r.AMapManager;var l={data(){const e=this;return{dialogVisible:!1,zoom:15,address:"",center:[114.351733,29.900505],markers:[],searchOption:{city:"",citylimit:!1},amapManager:s,plugin:[{pName:"Geolocation",events:{init(t){console.log("触发了----",t),t.getCurrentPosition(((t,n)=>{if(n&&n.position){e.lng=n.position.lng,e.lat=n.position.lat,e.address=n.formattedAddress,e.center=[e.lng,e.lat];let t=s.getMap();e.marker||(e.marker=new AMap.Marker({position:e.center}),e.marker.setMap(t)),e.marker.setPosition(e.center)}}))}}}],plugin:["ToolBar",{pName:"MapType",defaultType:0,events:{init(e){}}}],events:{init:e=>{e.getCity((e=>{}))},moveend:()=>{},zoomchange:()=>{},click:t=>{console.log("点击地图选择的位置+",t),e.lng=t.lnglat.lng,e.lat=t.lnglat.lat,e.center=[e.lng,e.lat];let n=s.getMap();e.marker||(e.marker=new AMap.Marker({position:t.lnglat}),e.marker.setMap(n)),e.marker.setPosition(t.lnglat);let o=new AMap.Geocoder({});o.getAddress(t.lnglat,(function(t,n){"complete"===t&&n.regeocode?e.address=n.regeocode.formattedAddress:log.error("根据经纬度查询地址失败")}))}},markers:[{position:[114.351733,29.900505],label:{content:"骑手",offset:[-20,-30]},icon:"https://img.fphdcdn.com/member/2023-01-13PPf3JHHHx5.png"},{position:[114.345458,29.895411],label:{content:"店家",offset:[-20,-30]},icon:"https://img.fphdcdn.com/member/2023-01-13PPf3JHHHx5.png"}],distance:null}},created(){this.getLongitudeLatitude(),this.markers.push(this.center),this.distance=(0,i.oW)(29.900505,114.351733,29.895411,114.345458).distance.toFixed(2),console.log(this.distance),this.markers[0].label.content=`骑手距离店家${this.distance}km`},methods:{closeDialog(){this.dialogVisible=!1},onSearchResult(e){if(console.log("触发了pois",e),e.length>0){let{lng:t,lat:n,name:o,location:a}=e[0],i=[t,n];this.lng=t,this.lat=n,this.center=[t,n];let r=s.getMap();this.marker||(this.marker=new AMap.Marker({position:i}),this.marker.setMap(r)),this.marker.setPosition(i);let l=new AMap.Geocoder({}),c=this;l.getAddress(a,(function(e,t){console.log(e,t),"complete"===e&&t.regeocode?c.address=t.regeocode.formattedAddress:console.log("根据经纬度查询地址失败")}))}},comfirmLngLat(e,t){this.dialogVisible=!1,console.log("经纬度",e),console.log("选择的地址",t)},getLongitudeLatitude(){if("geolocation"in navigator){var e={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};function t(e){e.coords.latitude,e.coords.longitude}function n(e){console.log("err",e);var t=["您拒绝共享位置信息","获取不到位置信息","获取位置信息超时"];console.log(t[e.code-1])}navigator.geolocation.getCurrentPosition(t,n,e)}else console.log("无法获取您的位置，请检查定位是否开启或刷新重试")}}},c=l,d=n(43736),g=(0,d.Z)(c,o,a,!1,null,"2052ee9b",null),u=g.exports},42325:function(e,t,n){n.d(t,{FR:function(){return s},N2:function(){return r},iw:function(){return o},jE:function(){return l},oW:function(){return a},tK:function(){return c},zi:function(){return i}});const o=(e,t)=>{var n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=function(){var e=document.createElement("canvas");e.width=n.width,e.height=n.height;var o=e.getContext("2d");o.drawImage(n,0,0,n.width,n.height);var a=e.toDataURL("image/png"),i=document.createElement("a"),r=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});i.download=t||"photo",i.href=a,i.dispatchEvent(r)},n.src=e},a=(e,t,n,o)=>{function a(e){return e*Math.PI/180}var i=a(e),r=a(n),s=i-r,l=a(t)-a(o),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(s/2),2)+Math.cos(i)*Math.cos(r)*Math.pow(Math.sin(l/2),2)));c*=6378.137,c=Math.round(1e4*c)/1e4;var d=c,g="";g=parseInt(d)>=1?d.toFixed(2)+"km":(1e3*d).toFixed(2)+"m";let u={distance:d,distance_str:g};return u},i=(e,t)=>{if(void 0==e||""==e)return;var n=new Date(Number(e)),o=n.getFullYear(),a=n.getMonth()+1<10?"0"+(n.getMonth()+1):""+(n.getMonth()+1),i=n.getDate()<10?"0"+n.getDate():""+n.getDate(),r=n.getHours(),s=n.getMinutes()<10?"0"+n.getMinutes():""+n.getMinutes(),l=n.getSeconds();const c=e=>{let t=new Map([[1,o+"-"+a+"-"+i],[2,o+"-"+a+"-"+i+" "+r+":"+s+":"+l],["default",o+"-"+a+"-"+i+" "+r+":"+s+":"+l]]);return t.get(e)||t.get("default")};return c(t)},r=(e,t)=>{let n=null;return function(){let o=this,a=arguments;n&&clearTimeout(n),n=setTimeout((()=>{e.apply(o,a)}),t)}},s=e=>{let t=!0;return Object.keys(e).forEach((function(n){null!==e[n]&&void 0!==e[n]||(t=!1)})),t},l=(e,t)=>{for(let n=0;n<e.length;n++){if(e[n].router===t)return e[n].name;if(e[n].children&&e[n].children.length>0){let o=l(e[n].children,t);if(o)return e[n].name+" / "+o}}return null},c=(e,t)=>{var n=!1,o=null;function a(e,t){for(var i=0;i<e.length;i++)if(e[i].children&&e[i].children.length>0&&a(e[i].children,t),t===e[i].router||n){n||(o=e[i]),n=!0;break}}return a(e,t),o}}}]);