"use strict";(self.webpackChunkvue_test=self.webpackChunkvue_test||[]).push([[647],{83647:function(e,t,a){a.r(t),a.d(t,{default:function(){return n}});a(57658);var i=a(42325);let o=new(a(25275).AMapManager);var t={data(){const a=this;return{dialogVisible:!1,zoom:15,address:"",center:[114.351733,29.900505],markers:[],searchOption:{city:"",citylimit:!1},amapManager:o,plugin:[{pName:"Geolocation",events:{init(e){e.getCurrentPosition((e,t)=>{t&&t.position&&(a.lng=t.position.lng,a.lat=t.position.lat,a.address=t.formattedAddress,a.center=[a.lng,a.lat],t=o.getMap(),a.marker||(a.marker=new AMap.Marker({position:a.center}),a.marker.setMap(t)),a.marker.setPosition(a.center))})}}}],plugin:["ToolBar",{pName:"MapType",defaultType:0,events:{init(e){}}}],events:{init:e=>{e.getCity(e=>{})},moveend:()=>{},zoomchange:()=>{},click:e=>{a.lng=e.lnglat.lng,a.lat=e.lnglat.lat,a.center=[a.lng,a.lat];var t=o.getMap();a.marker||(a.marker=new AMap.Marker({position:e.lnglat}),a.marker.setMap(t)),a.marker.setPosition(e.lnglat),new AMap.Geocoder({}).getAddress(e.lnglat,function(e,t){"complete"===e&&t.regeocode?a.address=t.regeocode.formattedAddress:log.error("根据经纬度查询地址失败")})}},markers:[{position:[114.351733,29.900505],label:{content:"骑手",offset:[-20,-30]},icon:"https://img.fphdcdn.com/member/2023-01-13PPf3JHHHx5.png"},{position:[114.345458,29.895411],label:{content:"店家",offset:[-20,-30]},icon:"https://img.fphdcdn.com/member/2023-01-13PPf3JHHHx5.png"}],distance:null}},created(){this.getLongitudeLatitude(),this.markers.push(this.center),this.distance=(0,i.oW)(29.900505,114.351733,29.895411,114.345458).distance.toFixed(2),this.markers[0].label.content=`骑手距离店家${this.distance}km`},methods:{closeDialog(){this.dialogVisible=!1},onSearchResult(e){if(0<e.length){var{lng:e,lat:t,location:i}=e[0],n=[e,t],e=(this.lng=e,this.lat=t,this.center=[e,t],o.getMap()),t=(this.marker||(this.marker=new AMap.Marker({position:n}),this.marker.setMap(e)),this.marker.setPosition(n),new AMap.Geocoder({}));let a=this;t.getAddress(i,function(e,t){"complete"===e&&t.regeocode&&(a.address=t.regeocode.formattedAddress)})}},comfirmLngLat(e,t){this.dialogVisible=!1},getLongitudeLatitude(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(function(e){e.coords.latitude,e.coords.longitude},function(e){},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}}},n=(0,a(1001).Z)(t,function(){var t=this,a=t._self._c;return a("div",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!0}}},[t._v(" 地图")]),a("el-dialog",{attrs:{visible:t.dialogVisible,width:"70%",height:"60%",top:"10vh"},on:{close:t.closeDialog,"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"amap-page-container",staticStyle:{width:"100%",height:"550px",margin:"0px"}},[a("el-amap-search-box",{staticClass:"search-box",attrs:{"search-option":t.searchOption,"on-search-result":t.onSearchResult}}),a("el-amap",{ref:"map",staticClass:"amap-demo",attrs:{vid:"amapDemo","amap-manager":t.amapManager,center:t.center,zoom:t.zoom,plugin:t.plugin,events:t.events}},t._l(t.markers,function(e,t){return a("el-amap-marker",{key:t,attrs:{position:e.position,label:e.label,icon:e.icon}})}),1),a("div",{staticStyle:{display:"flex",position:"relative"}},[a("div",{staticClass:"adress"},[a("p",[t._v(t._s(t.address))]),a("p",[t._v(t._s(t.center))])]),a("div",{staticClass:"confirm",on:{click:function(e){return t.comfirmLngLat(t.center,t.address)}}},[t._v("确定")])])],1)])],1)},[],!1,null,"2052ee9b",null).exports},42325:function(e,t,a){a.d(t,{iw:function(){return i},oW:function(){return n}});const i=(e,i)=>{var n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=function(){var e=document.createElement("canvas");e.width=n.width,e.height=n.height;e.getContext("2d").drawImage(n,0,0,n.width,n.height);var e=e.toDataURL("image/png"),t=document.createElement("a"),a=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.download=i||"photo",t.href=e,t.dispatchEvent(a)},n.src=e};const n=(e,t,a,i)=>{function n(e){return e*Math.PI/180}e=n(e),a=n(a),t=n(t)-n(i),i=2*Math.asin(Math.sqrt(Math.pow(Math.sin((e-a)/2),2)+Math.cos(e)*Math.cos(a)*Math.pow(Math.sin(t/2),2))),i*=6378.137,e=i=Math.round(1e4*i)/1e4,a="",a=1<=parseInt(e)?e.toFixed(2)+"km":(1e3*e).toFixed(2)+"m";return{distance:e,distance_str:a}}}}]);